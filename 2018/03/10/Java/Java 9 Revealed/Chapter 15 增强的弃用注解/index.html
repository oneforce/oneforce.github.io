<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>增强的弃用注解 | oneforce blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.bootcss.com/mermaid/6.0.0/mermaid.min.css"><script src="//cdn.bootcss.com/mermaid/6.0.0/mermaid.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-113549521-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">增强的弃用注解</h1><a id="logo" href="/.">oneforce blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">增强的弃用注解</h1><div class="post-meta">Mar 10, 2018<span> | </span><span class="category"><a href="/categories/Java-9-Revealed/">Java 9 Revealed</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2018/03/10/Java/Java 9 Revealed/Chapter 15 增强的弃用注解/" href="/2018/03/10/Java/Java 9 Revealed/Chapter 15 增强的弃用注解/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一-什么是弃用"><span class="toc-text">一. 什么是弃用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-如何弃用API"><span class="toc-text">二. 如何弃用API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-JDK-9中-Deprecated注解的更新"><span class="toc-text">三. JDK 9中@Deprecated注解的更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四-抑制弃用警告"><span class="toc-text">四. 抑制弃用警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五-一个弃用API示例"><span class="toc-text">五. 一个弃用API示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六-静态分析弃用的API"><span class="toc-text">六. 静态分析弃用的API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七-动态分析弃用的API"><span class="toc-text">七. 动态分析弃用的API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八-导入时没有弃用警告"><span class="toc-text">八 导入时没有弃用警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九-总结"><span class="toc-text">九. 总结</span></a></li></ol></div></div><div class="post-content"><p><a href="http://www.cnblogs.com/IcanFixIt/p/7234054.html" target="_blank" rel="noopener">原文地址</a></p>
<p>主要介绍以下内容：</p>
<ul>
<li>如何弃用API</li>
<li><code>@deprecate</code> Javadoc标签和<code>@Deprecation</code>注解在弃用的API中的角色</li>
<li>用于生成弃用警告的详细规则</li>
<li>在JDK 9中更新@Deprecation注解</li>
<li>JDK 9中的新的弃用警告</li>
<li>如何使用@SuppressWarnings注解来抑制JDK 9中的不同类型的弃用警告</li>
<li>如何使用<code>jdeprscan</code>静态分析工具来扫描编译的代码库，以查找已弃用的JDK API的用法</li>
</ul>
<h2 id="一-什么是弃用"><a href="#一-什么是弃用" class="headerlink" title="一. 什么是弃用"></a>一. 什么是弃用</h2><p>Java中的弃用是提供有关API生命周期的信息的一种方式。 可以弃用模块，包，类型，构造函数，方法，字段，参数和局部变量。 当弃用API时，要告诉其用户：</p>
<ul>
<li>不要使用API，因为它存在风险。</li>
<li>API已经迁移，因为存在API的更好的替代方案。</li>
<li>API已经迁移，因为API将在以后的版本中被删除。</li>
</ul>
<h2 id="二-如何弃用API"><a href="#二-如何弃用API" class="headerlink" title="二. 如何弃用API"></a>二. 如何弃用API</h2><p>JDK有两个用于弃用API的结构：</p>
<ul>
<li><code>@deprecated</code> Javadoc标签</li>
<li><code>@Deprecated</code>注解</li>
</ul>
<p><code>@deprecated</code> Javadoc标签已添加到JDK 1.1中，它允许使用丰富的HTML文本格式功能指定关于弃用的详细信息。JDK 5.0中添加了<code>java.lang.Deprecated</code>注解类型，并且可以在已被弃用的API元素上使用。 在JDK 9之前，注解不包含任何元素。 它在运行时保留。</p>
<p><code>@deprecated</code>标签和@Deprecated注解应该一起使用。 两者都应该存在或两者都不存在。 @Deprecation注解不允许指定弃用的描述，因此必须使用@deprecated标签来提供描述。</p>
<p>描述，因此必须使用<code>@deprecated</code>标签来提供描述。</p>
<blockquote>
<p>Tips</p>
<p>在API元素上使用<code>@deprecated</code>标签（而不是<code>@Deprecated</code>注解）会生成编译器警告。 在JDK 9之前，需要使用<code>-Xlint：dep-ann</code>编译器标志来查看这些警告。</p>
</blockquote>
<p>下面包含<code>FileCopier</code>类的声明。 假设这个类作为类库迁移的一部分。 该类使用<code>@Deprecation</code>注解表示弃用。 它的Javadoc使用<code>@deprecated</code>标签来提供不推荐使用的详细信息，例如不推荐使用的时间，它的替换和删除通知。 在JDK 9之前，@Deprecated注解类型不包含任何元素，因此必须使用Javadoc中已弃用的API的@deprecated标签提供有关弃用的所有详细信息。 请注意，Javadoc中使用的@since标签表示FileCopier类自该库的版本1.2以来已经存在，而@deprecated标签表示该类自版本1.4以来已被弃用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FileCopier.java</span></span><br><span class="line"><span class="keyword">package</span> com.jdojo.deprecation;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The class consists of static methods that can be used to</span></span><br><span class="line"><span class="comment"> * copy files and directories.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@deprecated</span> Deprecated since 1.4. Not safe to use. Use the</span></span><br><span class="line"><span class="comment"> * &lt;code&gt;java.nio.file.Files&lt;/code&gt; class instead. This class</span></span><br><span class="line"><span class="comment"> * will be removed in a future release of this library.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileCopier</span> </span>&#123;</span><br><span class="line">    <span class="comment">// No direct instantiation supported.</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">FileCopier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Copies the contents of src to dst.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src The source file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dst The destination file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if the copy is successfully,</span></span><br><span class="line"><span class="comment">     * false otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">copy</span><span class="params">(File src, File dst)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// More code goes here</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// More methods go here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Javadoc工具将<code>@deprecated</code>标签的内容移动到生成的Javadoc中的顶部，以引起读者的注意。 当不被弃用的代码使用不推荐使用的API时，编译器会生成警告。 请注意，使用@Deprecated注解标注API不会生成警告；但是，使用已经使用<code>@Deprecated</code>注解标注的API。 如果在类本身之外使用<code>FileCopier</code>类，则会收到关于使用不推荐使用的类的编译器警告。</p>
<h2 id="三-JDK-9中-Deprecated注解的更新"><a href="#三-JDK-9中-Deprecated注解的更新" class="headerlink" title="三. JDK 9中@Deprecated注解的更新"></a>三. JDK 9中<code>@Deprecated</code>注解的更新</h2><p>假设编译了代码并将其部署到生产环境中。如果升级了JDK版本或包含旧应用程序使用的新的已弃用的API的库/框架，则不会收到任何警告，并且将错过从不推荐使用的API迁移的机会。必须重新编译代码以接收警告。没有任何扫描和分析编译代码（例如JAR文件）的工具，并报告使用已弃用的API。更坏的情况是，从旧版本中删除不推荐使用的API，而旧的编译代码会收到意外的运行时错误。当他们查看不赞成使用的元素Javadoc时，开发人员也感到困惑 —— 当API被废弃时，无法表达何种方式，以及在将来的版本中是否会删除已弃用的API。所有可以做的是在文本中将这些信息指定为@deprecated标签的一部分。 JDK 9尝试通过增强@Deprecated注解来解决这些问题。注解在JDK 9中已增加两个新元素：since和forRemoval。</p>
<p>在JDK 9之前，注解的声明如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Deprecated &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在JDK 9中，弃用注解的声明更改为以下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, MODULE, PARAMETER, TYPE&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Deprecated &#123;</span><br><span class="line">    <span class="function">String <span class="title">since</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">forRemoval</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两个新元素都具有指定的默认值，因此注解的现有使用不会有问题。 <code>since</code>元素指定已注解的API元素已被弃用的版本。 它是一个字符串，将遵循与JDK版本方案相同的版本命名约定，例如“9”。 它默认为空字符串。 请注意，JDK 9没有向<code>@Deprecated</code>注解类型添加元素，以指定不推荐的描述。 这是由于两个原因：</p>
<ul>
<li>注解在运行时保留。 向注解添加描述性文本将添加到运行时内存。</li>
<li>描述性文字不能只是纯文本。 例如，它需要提供一个链接来替代已弃用的API。 现有的@deprecated Javadoc标签已经提供了这个功能。</li>
</ul>
<p><code>forRemoval</code>元素表示注解的API元素在将来的版本中被删除，应该迁移API。 它默认为false。</p>
<blockquote>
<p>Tips</p>
<p>元素上的@since Javadoc标签表示何时添加了API元素，而@Deprecated注解的since元素表示API元素已被弃用。</p>
</blockquote>
<p>在JDK 9之前，弃用警告是基于API元素及其使用场景（use-site）上使用@Deprecated注解的问题，如下所示。 当在没有弃用的使用场景使用不推荐使用的API元素时，会发出警告。 如果声明及其使用场景都已弃用，则不会发出任何警告。 可以通过使用@SuppressWarnings(“deprecation”)注解标示用户场景来抑制弃用警告。</p>
<table>
<thead>
<tr>
<th>API Use-Site</th>
<th>API Declaration Site</th>
<th>API Declaration Site</th>
</tr>
</thead>
<tbody>
<tr>
<td>Empty</td>
<td>Not Deprecated</td>
<td>Deprecated</td>
</tr>
<tr>
<td>Not Deprecated</td>
<td>N</td>
<td>W</td>
</tr>
<tr>
<td>Deprecate</td>
<td>N</td>
<td>N</td>
</tr>
<tr>
<td>N = No warning,    W = Warning</td>
</tr>
</tbody>
</table>
<p>在<code>@Deprecation</code>注解类型中添加<code>forRemoval</code>元素增加了多于五个用例。 当<code>forRemoval</code>设置为false时，不推荐使用API，则将这种弃用称为普通弃用，在这种情况下发出的警告称为普通弃用警告。 当<code>forRemoval</code>设置为true时，不推荐使用API，则将这种弃用称为终止弃用，并且在这种情况下发出的警告称为终止弃用警告或删除警告。</p>
<table>
<thead>
<tr>
<th>API Use-Site</th>
<th>API Declaration Site</th>
<th>API Declaration Site</th>
<th>API Declaration Site</th>
</tr>
</thead>
<tbody>
<tr>
<td>Empty</td>
<td>Not Deprecated</td>
<td>Ordinarily</td>
<td>Deprecated</td>
<td>TerminallyDeprecated</td>
</tr>
<tr>
<td>Not Deprecated</td>
<td>N</td>
<td>OW</td>
<td>RW</td>
</tr>
<tr>
<td>Ordinarily Deprecated</td>
<td>N</td>
<td>N</td>
<td>RW</td>
</tr>
<tr>
<td>Terminally Deprecated</td>
<td>N</td>
<td>N</td>
<td>RW</td>
</tr>
<tr>
<td>N = No warning,</td>
<td>OW = Ordinary deprecation warning,</td>
<td>RW = Removal deprecation warning</td>
</tr>
</tbody>
</table>
<p>为了实现向后兼容，如果代码在JDK 8中生成了弃用警告，它将继续在JDK 9中生成普通的弃用警告。如果API已经被终止使用，其使用场景将生成删除警告，而不考虑使用场景状态。</p>
<p>在JDK 9中，在一个情况下发出的警告，其API和其使用场景都被最终弃用，这些警告需要一点解释。 API和使用它的代码都已被弃用，并且将来都会被删除，所以在这种情况下要发出警告是什么意思？ 这样做是为了涵盖最终弃用的API及其使用场景在两个不同的代码库中并独立维护的情况。 如果使用场景代码库存活超过了API代码库，则用场景将会收到意外的运行时错误，因为它使用的API不再存在。用场景发出警告将提供一个机会，以防在用场景的代码去掉之前，来计划替代最终弃用的API。</p>
<h2 id="四-抑制弃用警告"><a href="#四-抑制弃用警告" class="headerlink" title="四. 抑制弃用警告"></a>四. 抑制弃用警告</h2><p>介绍JDK 9中的removal警告已添加了一个新的用例来抑制弃用警告。 在JDK 9之前，可以通过使用<code>@SuppressWarnings(&quot;deprecation&quot;)</code>注解标示使用场景来抑制所有弃用警告。 考虑以下几种情况：</p>
<ul>
<li>在JDK 8中，弃用的API和使用场景会抑制弃用警告。</li>
<li>在JDK 9中，API的弃用从普通的弃用变为最终弃用。</li>
<li>由于JDK 8中抑制了弃用警告，所以在JDK 9中使用场景的编译没有问题。</li>
<li>API被删除，并且使用场景收到意外的运行时错误，而不会在之前接收到任何删除警告。</li>
</ul>
<p>为了涵盖这种情况，当使用<code>@SuppressWarnings(&quot;deprecation&quot;)</code>，JDK 9不会抑制删除警告。 它只抑制普通的弃用警告。 要抑制删除警告，需要使用<code>@SuppressWarnings(&quot;removal&quot;)</code>。 如果要抑制普通和删除的弃用警告，则需要使用<code>@SuppressWarnings({“deprecation”, &quot;removal&quot;})</code>。</p>
<h2 id="五-一个弃用API示例"><a href="#五-一个弃用API示例" class="headerlink" title="五. 一个弃用API示例"></a>五. 一个弃用API示例</h2><p>在本节中，展示弃用API的所有用例，使用弃用使用的API，并通过一个简单的示例来抑制警告。 在该示例中，对方法标示为弃用的，并使用它们来生成编译时警告。 但是，不限于仅弃用方法。 对这些方法的注解可以更好地了解预期的行为。 下面包含一个Box类的代码。 该类包含三种方法 —— 没有弃用的方法，普通的弃用方法和最终弃用的方法。 编译Box类不会生成任何废弃警告，因为该类不使用任何已弃用的API，而是包含过时的API。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Box.java</span></span><br><span class="line"><span class="keyword">package</span> com.jdojo.deprecation;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This class is used to demonstrate how to deprecate APIs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Not deprecated</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">notDeprecated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"notDeprecated..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Deprecated ordinarily.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span>  Do not use it.</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deprecatedOrdinarily</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"deprecatedOrdinarily..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Deprecated terminally.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span>  It will be removed in a future release.</span></span><br><span class="line"><span class="comment">     *              Migrate your code.</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"2"</span>, forRemoval=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deprecatedTerminally</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"deprecatedTerminally..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面包含<code>BoxTest</code>类的代码。 该类使用<code>Box</code>类的所有方法。 BoxTest类中的几种方法已经被普遍和最终弃用了。 <code>m4X()</code>的方法，其中X是数字，显示如何抑制弃用警告。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Box.java</span></span><br><span class="line"><span class="keyword">package</span> com.jdojo.deprecation;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This class is used to demonstrate how to deprecate APIs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Not deprecated</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">notDeprecated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"notDeprecated..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Deprecated ordinarily.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span>  Do not use it.</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deprecatedOrdinarily</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"deprecatedOrdinarily..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Deprecated terminally.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span>  It will be removed in a future release.</span></span><br><span class="line"><span class="comment">     *              Migrate your code.</span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"2"</span>, forRemoval=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deprecatedTerminally</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"deprecatedTerminally..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">下面包含BoxTest类的代码。 该类使用Box类的所有方法。 BoxTest类中的几种方法已经被普遍和最终弃用了。 m4X()的方法，其中X是数字，显示如何抑制弃用警告。</span><br><span class="line"></span><br><span class="line"><span class="comment">// BoxTest.java</span></span><br><span class="line"><span class="keyword">package</span> com.jdojo.deprecation;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BoxTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Not deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: No warning</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m11</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.notDeprecated();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * API: Ordinarily deprecated</span></span><br><span class="line"><span class="comment">    * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">    * Deprecation warning: No warning</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m12</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Removal warning</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m13</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Not deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Ordinarily deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: No warning</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span> Dangerous to use.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"1.1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m21</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.notDeprecated();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * API: Ordinarily deprecated</span></span><br><span class="line"><span class="comment">    * Use-site: Ordinarily deprecated</span></span><br><span class="line"><span class="comment">    * Deprecation warning: No warning</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@deprecated</span> Dangerous to use.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"1.1"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m22</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Ordinarily deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Removal warning</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span> Dangerous to use.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"1.1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m23</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Not deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: No warning</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span> Going away.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"1.1"</span>, forRemoval=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m31</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.notDeprecated();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * API: Ordinarily deprecated</span></span><br><span class="line"><span class="comment">    * Use-site: Terminally deprecated</span></span><br><span class="line"><span class="comment">    * Deprecation warning: No warning</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@deprecated</span> Going away.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"1.1"</span>, forRemoval=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m32</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Removal warning</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@deprecated</span> Going away.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Deprecated</span>(since=<span class="string">"1.1"</span>, forRemoval=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m33</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Ordinarily and Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Ordinary and removal warnings</span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m41</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">        Box.deprecatedTerminally();        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Ordinarily and Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Ordinary warnings</span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"deprecation"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m42</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">        Box.deprecatedTerminally();        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Ordinarily and Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Removal warnings</span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"removal"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m43</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">        Box.deprecatedTerminally();        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API: Ordinarily and Terminally deprecated</span></span><br><span class="line"><span class="comment">     * Use-site: Not deprecated</span></span><br><span class="line"><span class="comment">     * Deprecation warning: Removal warnings</span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"deprecation"</span>, <span class="string">"removal"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m44</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">        Box.deprecatedTerminally();        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要使用<code>-Xlint：deprecation</code>编译器标志来编译<code>BoxTest</code>类，因此编译会发出弃用警告。 请注意，以下命令在一行上输入，而不是两行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Java9Revealed\com.jdojo.deprecation\src&gt;javac -Xlint:deprecation -d ..\build\classes com\jdojo\deprecation\BoxTest.java</span><br></pre></td></tr></table></figure>
<p>输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">com\jdojo\deprecation\BoxTest.java:20: warning: [deprecation] deprecatedOrdinarily() in Box has been deprecated</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:29: warning: [removal] deprecatedTerminally() in Box has been deprecated and marked for removal</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:62: warning: [removal] deprecatedTerminally() in Box has been deprecated and marked for removal</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:95: warning: [removal] deprecatedTerminally() in Box has been deprecated and marked for removal</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:105: warning: [deprecation] deprecatedOrdinarily() in Box has been deprecated</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:106: warning: [removal] deprecatedTerminally() in Box has been deprecated and marked for removal</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:117: warning: [removal] deprecatedTerminally() in Box has been deprecated and marked for removal</span><br><span class="line">        Box.deprecatedTerminally();</span><br><span class="line">           ^</span><br><span class="line">com\jdojo\deprecation\BoxTest.java:127: warning: [deprecation] deprecatedOrdinarily() in Box has been deprecated</span><br><span class="line">        Box.deprecatedOrdinarily();</span><br><span class="line">           ^</span><br><span class="line">8 warnings</span><br><span class="line">···</span><br></pre></td></tr></table></figure>
<h2 id="六-静态分析弃用的API"><a href="#六-静态分析弃用的API" class="headerlink" title="六. 静态分析弃用的API"></a>六. 静态分析弃用的API</h2><p>弃用警告是编译时警告。 如果部署的应用程序的编译代码开始使用通常已弃用的API或生成运行时错误，一旦有效的API已被终止使用并被删除，那么将不会收到任何警告。 在JDK 9之前，必须重新编译源代码，以便在升级JDK或其他库/框架时查看废弃用警告。 JDK 9通过提供一个jdeprscan的静态分析工具来改善这种情况，该工具可用于扫描已编译的代码，以查看所使用的已弃用的API列表。 目前，该工具报告了仅JDK中弃用 API。 如果编译的代码使用其他库中不弃用的API，例如Spring或Hibernate或自己的库，则此工具将不会报告这些。</p>
<p>jdeprscan工具位于JDK_HOME\bin目录中。 使用该工具的一般语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdeprscan [options] &#123;dir|jar|class&#125;</span><br></pre></td></tr></table></figure>
<p>这里，[options]是零个或多个选项的列表。 可以指定一个空格分隔目录，JAR或完全限定类名的列表作为要扫描的参数。 可用选项如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-l, --list</span><br><span class="line">--class-path &lt;CLASSPATH&gt;</span><br><span class="line">--for-removal</span><br><span class="line">--release &lt;6|7|8|9&gt;</span><br><span class="line">-v, --verbose</span><br><span class="line">--version</span><br><span class="line">--full-version</span><br><span class="line">-h, --help</span><br></pre></td></tr></table></figure>
<ul>
<li><code>--list</code> 选项列出了Java SE中的一些弃用的API。 当使用此选项时，不应指定编译类的位置的参数。</li>
<li><code>--class-path</code>指定在扫描期间用于查找依赖类的类路径。</li>
<li><code>--for-removal</code>选项将扫描或列表限制为只被弃用去除的那些API。 它只能在版本值为9或更高版本中使用，因为@Deprecated注解类型在JDK 9之前不包含forRemoval元素。</li>
<li><code>--release</code>选项指定Java SE版本，在扫描期间提供一组弃用的API。 例如，要在JDK 6中列出所有已弃用的API，工具将如下所示：<code>jdeprscan --list --release 6</code></li>
<li><code>--verbose</code>选项在扫描过程中打印其他消息。</li>
<li><code>--version</code>和<code>--full-version</code>选项分别打印jdeprscan工具的缩写和完整版本。</li>
<li><code>--help</code>选项打印有关jdeprscan工具的详细帮助消息。</li>
</ul>
<p>下面包含JDeprScanTest类的代码。 代码很简单。 它只是编译，而不是运行。 运行它不会产生任何有趣的输出。 它创建两个线程。 一个线程使用Thread类的stop()方法停止，另一个线程使用Thread类的<code>destroy()</code>方法进行销毁。 从JDK 1.2和JDK 1.5开始，<code>stop()</code>和<code>destroy()</code>方法为普通弃用。 JDK 9已经最终弃用了<code>destroy()</code>方法，而继续保持<code>stop()</code>方法作为普通弃用。 在下面的例子中使用这个类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JDeprScanTest.java</span></span><br><span class="line"><span class="keyword">package</span> com.jdojo.deprecation;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDeprScanTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(() -&gt; System.out.println(<span class="string">"Test"</span>));</span><br><span class="line">        t.start();</span><br><span class="line">        t.stop();</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(() -&gt; System.out.println(<span class="string">"Test"</span>));</span><br><span class="line">        t2.start();</span><br><span class="line">        t2.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下命令打印JDK 9中所有已弃用的API的列表。它将打印一个长列表。 该命令需要几秒钟才能开始打印结果，因为它扫描整个JDK。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Java9Revealed&gt;jdeprscan --list</span><br></pre></td></tr></table></figure>
<p>输出的结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Deprecated java.lang.ClassLoader</span><br><span class="line"> javax.tools.ToolProvider.getSystemToolClassLoader()</span><br><span class="line"> ...</span><br><span class="line">The following command prints all terminally deprecated APIs in JDK 9. That is, it prints all deprecated APIs that have been marked for removal in a future release:</span><br><span class="line">C:\Java9Revealed&gt;jdeprscan --list --for-removal</span><br><span class="line"> ...</span><br><span class="line"> @Deprecated(since=&quot;9&quot;, forRemoval=true) class java.lang.Compiler</span><br><span class="line"> ...</span><br><span class="line">The following command prints the list of all APIs deprecated in JDK 8:</span><br><span class="line">C:\Java9Revealed&gt;jdeprscan --list --release 8</span><br><span class="line"> @Deprecated class javax.swing.text.TableView.TableCell</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>
<p>以下命令打印java.lang.Thread类使用的已弃用API的列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Java9Revealed&gt;jdeprscan java.lang.Thread</span><br></pre></td></tr></table></figure>
<p>输出的结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class java/lang/Thread uses deprecated method java/lang/Thread::resume()V</span><br></pre></td></tr></table></figure>
<p>请注意，之前的命令不会打印Thread类中已弃用的API列表。 相反，它打印使用弃用的API的Thread类中的API列表。</p>
<h2 id="七-动态分析弃用的API"><a href="#七-动态分析弃用的API" class="headerlink" title="七. 动态分析弃用的API"></a>七. 动态分析弃用的API</h2><p>jdeprscan工具是一个静态分析工具，因此它将跳过动态使用的弃用API。 例如，可以使用反射来调用已弃用的方法，这个工具在扫描过程中会错过。 还可以在由ServiceLoader加载的提供程序中调用弃用的方法，这将被该工具遗漏。</p>
<p>在未来的版本中，JDK可能会提供一个名为jdeprdetect的动态分析工具，该工具将在运行时跟踪弃用的API的使用。 该工具将有助于找到引用由静态分析工具jdeprscan报告的弃用的API的死代码。</p>
<h2 id="八-导入时没有弃用警告"><a href="#八-导入时没有弃用警告" class="headerlink" title="八 导入时没有弃用警告"></a>八 导入时没有弃用警告</h2><p>直到JDK 9，如果使用import语句导入了弃用类的构造函数，编译器就会生成警告，即使在已弃用导入的构造的所有使用站点上使用了<code>@SuppressWarnings</code>注解。 如果试图摆脱代码中的所有弃用警告，这是一个烦恼。 你不能摆脱它们，因为你不能注解import语句。 可以通过省略对导入弃用警告，JDK 9改进了这一点。</p>
<p>考虑下面ImportDeprecationWarning类，它在三个地方使用了弃用的StringBufferInputStream类：</p>
<ul>
<li>在导入语句中</li>
<li>在变量声明中</li>
<li>在实例创建的表达式中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// ImportDeprecationWarning.java</span><br><span class="line">package com.jdojo.deprecation;</span><br><span class="line">import java.io.StringBufferInputStream;</span><br><span class="line">public class ImportDeprecationWarning &#123;</span><br><span class="line">    @SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        StringBufferInputStream sbis =</span><br><span class="line">                new StringBufferInputStream(&quot;Hello&quot;);</span><br><span class="line">        for(int c = sbis.read(); c != -1; c = sbis.read()) &#123;</span><br><span class="line">            System.out.println((char)c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意，ImportDeprecationWarning类在main()方法上使用@SuppressWarnings注解来抑制弃用警告。 使用Xlint:deprecation`标志在JDK 8中编译此类将生成以下警告。 在JDK 9中编译此类不会生成任何弃用警告。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Java9Revealed\com.jdojo.deprecation\src&gt;javac -Xlint:deprecation -d ..\build\classes com\jdojo\deprecation\ImportDeprecationWarning.java</span><br></pre></td></tr></table></figure>
<p>输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com\jdojo\deprecation\ImportDeprecationWarning.java:4: warning: [deprecation] StringBufferInputStream in java.io has been deprecated</span><br><span class="line">import java.io.StringBufferInputStream;</span><br><span class="line">              ^</span><br><span class="line">1 warning</span><br></pre></td></tr></table></figure>
<p>在JDK 8中编译此类，在删除main()方法上的@SuppressWarnings注解后，编译器将生成三个弃用的警告 —— 一个用于每次使用弃用的StringBufferInputStream类，而JDK 9将仅生成两个弃用警告 —— 不包括导入声明的警告。</p>
<h2 id="九-总结"><a href="#九-总结" class="headerlink" title="九. 总结"></a>九. 总结</h2><p>Java中的弃用是提供有关API生命周期的信息的一种方式。 弃用API会告诉用户迁移，因为API有使用的危险，更好的替换存在，否则将在以后的版本中被删除。 使用弃用的API会生成编译时弃用警告。</p>
<p>@deprecated Javadoc标签和@Deprecated注解一起用于弃用API元素，如模块，包，类型，构造函数，方法，字段，参数和局部变量。 在JDK 9之前，注解不包含任何元素。 它在运行时保留。</p>
<p>JDK 9为注解添加了两个元素：since和forRemoval。 since元素默认为空字符串。 其值表示弃用的API元素的API版本。forRemoval元素的类型为boolean，默认为false。 其值为true表示API元素将在以后的版本中被删除。</p>
<p>JDK 9编译器根据@Deprecated注解的forRemoval元素的值生成两种类型的弃用警告：forRemoval = false时为普通的弃用警告，forRemoval = true时为最终的删除警告。</p>
<p>在JDK 9之前，可以通过使用@SuppressWarnings(“deprecation”)注解标示已弃用的API的使用场景来抑制弃用警告。 在JDK 9中，需要使用@SuppressWarnings(“deprecation”)来抑制普通警告，@SuppressWarnings(“removal”)来抑制删除警告，而@SuppressWarnings({“deprecation”, “removal”}可以抑制两种类型的警告。</p>
<p>在JDK 9之前，使用import语句导入弃用的构造会生成编译时弃用警告。 JDK 9省略了这样的警告。</p>
</div><p class="readmore"><a href="http://blog.oneforce.cn/online-markdown/?path=https://raw.githubusercontent.com/oneforce/oneforce.github.io/blog/source/_posts/Java/Java 9 Revealed/Chapter 15 增强的弃用注解.md">在微信markdown中展示</a></p><div class="tags"><a href="/tags/Java9/">Java9</a></div><div class="post-nav"><a class="pre" href="/2018/04/19/Java/Java 9 Revealed/Chapter 17 Reactive Streams/">响应式流</a><a class="next" href="/2018/03/06/Java/SpringBoot2/10. Installing Spring Boot/">&lt;&lt;Spring Boot 2&gt;&gt; 10. Installing Spring Boot</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"><input type="hidden" name="si" value="https://oneforce.github.io"><input name="tn" type="hidden" value="bds"><input name="cl" type="hidden" value="3"><input name="ct" type="hidden" value="2097152"><input name="s" type="hidden" value="on"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java-9-Revealed/">Java 9 Revealed</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Revealed/">Java Revealed</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot2/">SpringBoot2</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/参考文档/">参考文档</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/征信/">征信</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/私募基金/">私募基金</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/资产管理/">资产管理</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/金融法规/">金融法规</a><span class="category-list-count">15</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/入门系列/" style="font-size: 15px;">入门系列</a> <a href="/tags/tool/" style="font-size: 15px;">tool</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/spring-boot/" style="font-size: 15px;">spring boot</a> <a href="/tags/合规/" style="font-size: 15px;">合规</a> <a href="/tags/征信/" style="font-size: 15px;">征信</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/utf8/" style="font-size: 15px;">utf8</a> <a href="/tags/字符集/" style="font-size: 15px;">字符集</a> <a href="/tags/上海/" style="font-size: 15px;">上海</a> <a href="/tags/汽车/" style="font-size: 15px;">汽车</a> <a href="/tags/读书笔记/" style="font-size: 15px;">读书笔记</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/svn/" style="font-size: 15px;">svn</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/金融/" style="font-size: 15px;">金融</a> <a href="/tags/上海市互联网金融行业协会/" style="font-size: 15px;">上海市互联网金融行业协会</a> <a href="/tags/网络借贷/" style="font-size: 15px;">网络借贷</a> <a href="/tags/P2P/" style="font-size: 15px;">P2P</a> <a href="/tags/金融办/" style="font-size: 15px;">金融办</a> <a href="/tags/2018/" style="font-size: 15px;">2018</a> <a href="/tags/指引/" style="font-size: 15px;">指引</a> <a href="/tags/电子合同存证/" style="font-size: 15px;">电子合同存证</a> <a href="/tags/金融科技/" style="font-size: 15px;">金融科技</a> <a href="/tags/银监会/" style="font-size: 15px;">银监会</a> <a href="/tags/资产管理/" style="font-size: 15px;">资产管理</a> <a href="/tags/现金贷/" style="font-size: 15px;">现金贷</a> <a href="/tags/Java9/" style="font-size: 15px;">Java9</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/stream/" style="font-size: 15px;">stream</a> <a href="/tags/long/" style="font-size: 15px;">long</a> <a href="/tags/Spring-Boot-2/" style="font-size: 15px;">Spring Boot 2</a> <a href="/tags/springboot/" style="font-size: 15px;">springboot</a> <a href="/tags/原则/" style="font-size: 15px;">原则</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/p2p/" style="font-size: 15px;">p2p</a> <a href="/tags/代收/" style="font-size: 15px;">代收</a> <a href="/tags/央行/" style="font-size: 15px;">央行</a> <a href="/tags/证监会/" style="font-size: 15px;">证监会</a> <a href="/tags/私募基金/" style="font-size: 15px;">私募基金</a> <a href="/tags/PE/" style="font-size: 15px;">PE</a> <a href="/tags/委托贷款/" style="font-size: 15px;">委托贷款</a> <a href="/tags/私募/" style="font-size: 15px;">私募</a> <a href="/tags/jshell/" style="font-size: 15px;">jshell</a> <a href="/tags/collection/" style="font-size: 15px;">collection</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/http-2/" style="font-size: 15px;">http/2</a> <a href="/tags/fabric/" style="font-size: 15px;">fabric</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/说明文档/" style="font-size: 15px;">说明文档</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/10/05/金融/促进金融科技发展 支持上海建设金融科技中心/">金融/促进金融科技发展 支持上海建设金融科技中心</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/05/技术杂项/字符集和字符编码/">技术杂项/字符集和字符编码</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/13/说明/常用正则/">常用正则</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/26/技术杂项/架构/架构在做什么1/">架构在做什么1</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/02/金融/中国人民银行/中国人民银行关于规范代收业务的通知/">中国人民银行关于规范代收业务的通知 (征求意见稿)</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/02/金融/中国人民银行/中国人民银行关于规范代收业务 的通知（征求意见稿）》主要问题说明/">《中国人民银行关于规范代收业务的通知（征求意见稿）》主要问题说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/21/找书途径及下载方法/">找书途径及下载方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/30/金融/促进金融科技发展支持上海建设金融科技中心/">促进金融科技发展 支持上海建设金融科技中心</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/25/技术杂项/spring/设置context-path不能被服务发现的问题/">设置context-path不能被服务发现的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/21/金融/关于办理非法放贷刑事案件若干问题的意见/">关于办理非法放贷刑事案件若干问题的意见</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//oneforce-github-io.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">oneforce blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = '//hm.baidu.com/hm.js?' + '718da94a7cf34af2eac95661ab1fc06f';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script>(function () {
  var bp = document.createElement('script');
  bp.src = '//push.zhanzhang.baidu.com/push.js';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>